<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lightweight Web Text Editor (No Dependencies)</title>
<style>
  :root {
    --bg: #0b0c10;
    --panel: #121318;
    --muted: #1b1d26;
    --text: #e8eaed;
    --subtle: #9aa0a6;
    --accent: #4f8cff;
    --accent-2: #7b61ff;
    --border: #2a2e39;
    --shadow: 0 10px 25px rgba(0,0,0,.35);
    --radius: 14px;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif, "Apple Color Emoji","Segoe UI Emoji";
    color: var(--text);
    background: radial-gradient(1200px 800px at 20% -10%, #15203a 0%, transparent 60%),
                radial-gradient(700px 600px at 120% 20%, #1e123a 0%, transparent 60%),
                var(--bg);
    line-height: 1.35;
  }

  .container {
    max-width: 1100px;
    margin: 28px auto;
    padding: 0 16px;
  }

  .editor-wrap {
    background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0)) padding-box;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
  }

  .toolbar {
    position: sticky;
    top: 0;
    z-index: 5;
    display: grid;
    gap: 8px;
    grid-template-columns: repeat(12, minmax(0, 1fr));
    padding: 12px;
    background:
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0)) padding-box,
      linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)) border-box;
    border-bottom: 1px solid var(--border);
    backdrop-filter: blur(8px);
  }

  .group {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px;
    background: var(--muted);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: auto hidden;
  }

  .group::-webkit-scrollbar { height: 8px; }
  .group::-webkit-scrollbar-thumb { background: #333847; border-radius: 8px; }

  .toolbar .group:nth-child(1) { grid-column: span 12; }
  .toolbar .group:nth-child(2) { grid-column: span 8; }
  .toolbar .group:nth-child(3) { grid-column: span 4; }
  .toolbar .group:nth-child(4) { grid-column: span 12; }
  .toolbar .group:nth-child(5) { grid-column: span 12; }

  @media (min-width: 720px) {
    .toolbar .group:nth-child(1) { grid-column: span 3; }
    .toolbar .group:nth-child(2) { grid-column: span 5; }
    .toolbar .group:nth-child(3) { grid-column: span 4; }
    .toolbar .group:nth-child(4) { grid-column: span 7; }
    .toolbar .group:nth-child(5) { grid-column: span 5; }
  }

  button, select, input[type="color"] {
    -webkit-tap-highlight-color: transparent;
  }

  .btn, .select, .color {
    height: 36px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #171a22;
    color: var(--text);
    padding: 0 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    white-space: nowrap;
    user-select: none;
    transition: transform .06s ease, background .2s ease, border-color .2s ease;
  }
  .btn:active { transform: translateY(1px); }
  .btn:hover, .select:hover { background: #1d2230; }
  .btn[aria-pressed="true"] { outline: 2px solid var(--accent); border-color: var(--accent); }
  .btn svg { width: 18px; height: 18px; display: block; }

  .select { appearance: none; padding-right: 28px; position: relative; }
  .select-wrap { position: relative; display: inline-flex; }
  .select-wrap::after {
    content: "▾";
    position: absolute;
    right: 10px; top: 50%; transform: translateY(-50%);
    pointer-events: none; color: var(--subtle); font-size: 12px;
  }

  .color {
    padding: 0;
    width: 36px;
    border: 1px solid var(--border);
    background: transparent;
  }

  .sep {
    width: 1px; height: 22px; background: var(--border);
    margin: 0 2px;
  }

  .editor {
    min-height: 45vh;
    padding: 22px;
    background: #0f1117;
    outline: none;
    overflow-wrap: anywhere;
  }
  .editor:empty:before {
    content: attr(data-placeholder);
    color: var(--subtle);
  }

  .statusbar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 14px;
    font-size: 12px;
    color: var(--subtle);
    border-top: 1px solid var(--border);
    background: #0e1015;
  }

  .footer-actions {
    display: flex;
    gap: 8px;
  }

  .brand {
    font-weight: 600;
    letter-spacing: .3px;
    color: #cbd1ff;
  }

  /* Utility badges */
  .badge {
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #151826;
    color: var(--subtle);
  }

  /* Make toolbar controls wrap nicely on narrow screens */
  .group { flex-wrap: wrap; }

  /* Hide default file input */
  #imageInput { display: none; }
</style>
</head>
<body>
  <div class="container">
    <h1 style="margin:0 0 12px 0; font-size: 22px; font-weight: 700;">
      ✍️ Drop-in Rich Text Editor
    </h1>
    <div class="editor-wrap" id="editorWrap">
      <!-- Toolbar -->
      <div class="toolbar" id="toolbar" role="toolbar" aria-label="Text editor toolbar">
        <!-- Block type & font controls -->
        <div class="group" aria-label="Block & font">
          <span class="badge">Block</span>
          <span class="select-wrap">
            <select class="select" id="blockFormat" title="Block type">
              <option value="P">Paragraph</option>
              <option value="H1">Heading 1</option>
              <option value="H2">Heading 2</option>
              <option value="H3">Heading 3</option>
            </select>
          </span>

          <span class="sep" aria-hidden="true"></span>

          <span class="badge">Font</span>
          <span class="select-wrap">
            <select class="select" id="fontName" title="Font family">
              <option value="inherit" selected>Default</option>
              <option value="Arial">Arial</option>
              <option value="Georgia">Georgia</option>
              <option value="Tahoma">Tahoma</option>
              <option value="Times New Roman">Times New Roman</option>
              <option value="Trebuchet MS">Trebuchet MS</option>
              <option value="Verdana">Verdana</option>
              <option value="Courier New">Courier New</option>
              <option value="Comic Sans MS">Comic Sans MS</option>
            </select>
          </span>

          <span class="select-wrap">
            <select class="select" id="fontSize" title="Font size">
              <!-- Using execCommand fontSize (1–7). The label shows px-ish sizes. -->
              <option value="3" selected>16 px</option>
              <option value="1">10 px</option>
              <option value="2">13 px</option>
              <option value="3">16 px</option>
              <option value="4">18 px</option>
              <option value="5">24 px</option>
              <option value="6">32 px</option>
              <option value="7">48 px</option>
            </select>
          </span>
        </div>

        <!-- Inline formatting -->
        <div class="group" aria-label="Inline formatting">
          <button class="btn" data-cmd="bold" title="Bold (Ctrl/Cmd+B)" aria-label="Bold" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M13.5 15H9v4H6V5h7.5A4.5 4.5 0 0 1 18 9.5c0 1.86-1.14 3.43-2.75 4.07A4 4 0 0 1 13.5 15ZM9 7v4h4.5a2 2 0 0 0 0-4H9Zm0 6v4h4a2 2 0 1 0 0-4H9Z"/></svg>
          </button>
          <button class="btn" data-cmd="italic" title="Italic (Ctrl/Cmd+I)" aria-label="Italic" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M10 5v3h2.21l-2.42 8H7v3h10v-3h-2.21l2.42-8H17V5z"/></svg>
          </button>
          <button class="btn" data-cmd="underline" title="Underline (Ctrl/Cmd+U)" aria-label="Underline" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 17a5 5 0 0 0 5-5V5h-3v7a2 2 0 1 1-4 0V5H7v7a5 5 0 0 0 5 5Zm-6 2h12v2H6z"/></svg>
          </button>
          <button class="btn" data-cmd="strikeThrough" title="Strikethrough" aria-label="Strikethrough" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M5 11h14v2H5v-2Zm12.87 4A6.5 6.5 0 0 1 12 19c-3.5 0-6-1.57-6-4h3c0 1.06 1.47 2 3 2 1.82 0 2.86-.7 3.28-1H17.9ZM6.13 9A6.5 6.5 0 0 1 12 5c3.5 0 6 1.57 6 4h-3c0-1.06-1.47-2-3-2-1.82 0-2.86.7-3.28 1H6.1Z"/></svg>
          </button>

          <span class="sep" aria-hidden="true"></span>

          <span class="badge">Color</span>
          <input class="color" type="color" id="foreColor" title="Text color" />
          <input class="color" type="color" id="backColor" title="Highlight color" />
        </div>

        <!-- Alignment & lists -->
        <div class="group" aria-label="Alignment & lists">
          <button class="btn" data-cmd="justifyLeft" title="Align left" aria-label="Align left" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 5h18v2H3V5Zm0 4h12v2H3V9Zm0 4h18v2H3v-2Zm0 4h12v2H3v-2Z"/></svg>
          </button>
          <button class="btn" data-cmd="justifyCenter" title="Align center" aria-label="Align center" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M6 5h12v2H6V5Zm-3 4h18v2H3V9Zm3 4h12v2H6v-2Zm-3 4h18v2H3v-2Z"/></svg>
          </button>
          <button class="btn" data-cmd="justifyRight" title="Align right" aria-label="Align right" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 5h18v2H3V5Zm6 4h12v2H9V9ZM3 13h18v2H3v-2Zm6 4h12v2H9v-2Z"/></svg>
          </button>
          <button class="btn" data-cmd="justifyFull" title="Justify" aria-label="Justify" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3 5h18v2H3V5Zm0 4h18v2H3V9Zm0 4h18v2H3v-2Zm0 4h18v2H3v-2Z"/></svg>
          </button>

          <span class="sep" aria-hidden="true"></span>

          <button class="btn" data-cmd="insertUnorderedList" title="Bulleted list" aria-label="Bulleted list" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 5h14v2H7V5Zm0 12h14v2H7v-2Zm0-6h14v2H7v-2ZM3 5h2v2H3V5Zm0 6h2v2H3v-2Zm0 6h2v2H3v-2Z"/></svg>
          </button>
          <button class="btn" data-cmd="insertOrderedList" title="Numbered list" aria-label="Numbered list" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M7 5h14v2H7V5Zm0 12h14v2H7v-2Zm0-6h14v2H7v-2ZM5 5H3V3h4v6H5V5Zm0 6H3v-2h4v6H5v-4Zm0 6H3v-2h4v6H5v-4Z"/></svg>
          </button>
        </div>

        <!-- Links, images, undo/redo -->
        <div class="group" aria-label="Insert & history">
          <button class="btn" id="linkBtn" title="Insert link" aria-label="Insert link" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M3.9 12a4.1 4.1 0 0 1 4.1-4.1h4v2h-4a2.1 2.1 0 1 0 0 4.2h4v2h-4A4.1 4.1 0 0 1 3.9 12Zm6-1h4v2h-4v-2Zm6.1-3.1a4.1 4.1 0 0 1 0 8.2h-4v-2h4a2.1 2.1 0 1 0 0-4.2h-4v-2h4Z"/></svg>
          </button>
          <button class="btn" id="imageBtn" title="Insert image (URL or upload)" aria-label="Insert image" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2ZM8 7a2 2 0 1 1 0 4 2 2 0 0 1 0-4Zm11 10H5l4-5 3 4 2-3 5 4Z"/></svg>
          </button>
          <input type="file" id="imageInput" accept="image/*" />

          <span class="sep" aria-hidden="true"></span>

          <button class="btn" data-cmd="undo" title="Undo (Ctrl/Cmd+Z)" aria-label="Undo" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M7.41 7H14a7 7 0 0 1 0 14h-1v-2h1a5 5 0 1 0 0-10H7.41l2.3 2.29L8.29 12 4 7.71 8.29 3.4 9.7 4.82 7.41 7Z"/></svg>
          </button>
          <button class="btn" data-cmd="redo" title="Redo (Ctrl/Cmd+Y)" aria-label="Redo" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M16.59 7H10a7 7 0 1 0 0 14h1v-2h-1a5 5 0 1 1 0-10h6.59l-2.3 2.29L15.71 12 20 7.71 15.71 3.4 14.3 4.82 16.59 7Z"/></svg>
          </button>
        </div>

        <!-- Export -->
        <div class="group" aria-label="Export">
          <button class="btn" id="downloadTxt" title="Download as .txt" aria-label="Download as .txt" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Zm-2 2v6h6M7 14h10v2H7v-2Zm0 4h10v2H7v-2Z"/></svg>
            .txt
          </button>
          <button class="btn" id="downloadDoc" title="Download as .doc (Word-compatible)" aria-label="Download as .doc" onmousedown="event.preventDefault()">
            <svg viewBox="0 0 24 24"><path fill="currentColor" d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Zm-2 2v6h6M7 14h2l1 3 1-3h2l1 3 1-3h2l-2 6h-2l-1-3-1 3H9l-2-6Z"/></svg>
            .doc
          </button>
        </div>
      </div>

      <!-- Editable area -->
      <div id="editor"
           class="editor"
           contenteditable="true"
           spellcheck="true"
           data-placeholder="Start typing here…">
        <h1>Welcome 👋</h1>
        <p>This is a fully client-side rich text editor you can drop into any webpage. Try the toolbar above to format text, insert links and images, or export your content.</p>
        <ul>
          <li>Bold, italic, underline, strikethrough</li>
          <li>Headings &amp; paragraphs</li>
          <li>Alignment, lists, colors</li>
          <li>Undo/redo</li>
          <li>Download as <strong>.txt</strong> or <strong>.doc</strong></li>
        </ul>
      </div>

      <!-- Status bar -->
      <div class="statusbar">
        <div class="brand">Editor • Lightweight & Offline</div>
        <div class="footer-actions">
          <span id="wordCount" class="badge" title="Words">Words: 0</span>
          <span id="charCount" class="badge" title="Characters">Chars: 0</span>
        </div>
      </div>
    </div>
  </div>

<script>
(function () {
  const editor = document.getElementById('editor');
  const toolbar = document.getElementById('toolbar');

  // Enable legacy but widely supported commands
  document.execCommand('defaultParagraphSeparator', false, 'p');

  // Keep selection active when clicking toolbar controls
  let savedRange = null;
  function saveSelection() {
    const sel = window.getSelection();
    if (sel && sel.rangeCount) {
      savedRange = sel.getRangeAt(0);
    }
  }
  function restoreSelection() {
    if (savedRange) {
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(savedRange);
    }
  }
  editor.addEventListener('keyup', saveSelection);
  editor.addEventListener('mouseup', () => { saveSelection(); setTimeout(updateCounters, 0); });
  editor.addEventListener('blur', saveSelection);
  editor.addEventListener('input', updateCounters);

  // Generic command buttons
  toolbar.addEventListener('click', (e) => {
    const btn = e.target.closest('[data-cmd]');
    if (!btn) return;
    restoreSelection();
    const cmd = btn.getAttribute('data-cmd');
    document.execCommand(cmd, false, null);
    editor.focus();
    updateCounters();
  });

  // Block format (H1/H2/H3/P)
  document.getElementById('blockFormat').addEventListener('change', function () {
    restoreSelection();
    document.execCommand('formatBlock', false, this.value);
    editor.focus();
  });

  // Font family
  document.getElementById('fontName').addEventListener('change', function () {
    restoreSelection();
    if (this.value === 'inherit') {
      // Remove explicit font-family by wrapping selection into a span and clearing style
      // Fallback: apply defaultParagraphSeparator to reset for caret usage
      document.execCommand('removeFormat', false);
    } else {
      document.execCommand('fontName', false, this.value);
    }
    editor.focus();
  });

  // Font size (1..7 as per execCommand)
  document.getElementById('fontSize').addEventListener('change', function () {
    restoreSelection();
    document.execCommand('fontSize', false, this.value);
    editor.focus();
  });

  // Color pickers
  document.getElementById('foreColor').addEventListener('input', function () {
    restoreSelection();
    document.execCommand('foreColor', false, this.value);
    editor.focus();
  });
  document.getElementById('backColor').addEventListener('input', function () {
    restoreSelection();
    // Use hiliteColor where supported; fallback to backColor.
    const cmd = document.queryCommandSupported('hiliteColor') ? 'hiliteColor' : 'backColor';
    document.execCommand(cmd, false, this.value);
    editor.focus();
  });

  // Insert link
  document.getElementById('linkBtn').addEventListener('click', function () {
    restoreSelection();
    const url = prompt('Enter URL (https://…):');
    if (!url) return;
    try {
      const safe = sanitizeUrl(url);
      document.execCommand('createLink', false, safe);
      // Ensure the created link opens in a new tab and is safe
      const sel = window.getSelection();
      if (sel && sel.anchorNode) {
        let anchor = sel.anchorNode.parentElement;
        if (anchor && anchor.tagName !== 'A') anchor = anchor.closest('a');
        if (anchor) {
          anchor.setAttribute('target', '_blank');
          anchor.setAttribute('rel', 'noopener noreferrer');
        }
      }
    } catch (e) {}
    editor.focus();
  });

  // Insert image (URL or file)
  const imageBtn = document.getElementById('imageBtn');
  const imageInput = document.getElementById('imageInput');
  imageBtn.addEventListener('click', function () {
    // Offer a quick choice
    const method = prompt("Insert image:\n1) Paste/Type Image URL\n2) Upload from device\n\nType 1 or 2");
    if (!method) return;

    if (method.trim() === '2') {
      imageInput.click();
    } else {
      restoreSelection();
      const url = prompt('Enter image URL (https://…):');
      if (!url) return;
      try {
        const safe = sanitizeUrl(url);
        document.execCommand('insertImage', false, safe);
      } catch (e) {}
      editor.focus();
    }
  });

  imageInput.addEventListener('change', function () {
    const file = this.files && this.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function (ev) {
      restoreSelection();
      document.execCommand('insertImage', false, ev.target.result); // Data URL
      editor.focus();
    };
    reader.readAsDataURL(file);
    this.value = '';
  });

  // Downloads
  document.getElementById('downloadTxt').addEventListener('click', function () {
    const text = getPlainText(editor);
    downloadBlob(text, 'document.txt', 'text/plain;charset=utf-8');
  });
  document.getElementById('downloadDoc').addEventListener('click', function () {
    const html = buildDocHtml(editor.innerHTML);
    downloadBlob(html, 'document.doc', 'application/msword;charset=utf-8');
  });

  // Keyboard shortcuts for basic formatting
  document.addEventListener('keydown', (e) => {
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    const accel = isMac ? e.metaKey : e.ctrlKey;
    if (!accel) return;

    const key = e.key.toLowerCase();
    if (key === 'b') { e.preventDefault(); exec('bold'); }
    else if (key === 'i') { e.preventDefault(); exec('italic'); }
    else if (key === 'u') { e.preventDefault(); exec('underline'); }
    else if (key === 'z') { e.preventDefault(); exec('undo'); }
    else if (key === 'y') { e.preventDefault(); exec('redo'); }
  });

  function exec(cmd, val = null) {
    document.execCommand(cmd, false, val);
    editor.focus();
  }

  // Helpers
  function sanitizeUrl(url) {
    // Very small safety check – block javascript: and data: for links (allow data for images only via upload flow)
    const trimmed = (url || '').trim();
    const lower = trimmed.toLowerCase();
    if (lower.startsWith('javascript:')) throw new Error('Blocked');
    if (lower.startsWith('data:')) throw new Error('Blocked');
    return trimmed;
  }

  function getPlainText(el) {
    // Convert line breaks reasonably by replacing block elements with newlines
    const clone = el.cloneNode(true);
    // Insert line breaks for block tags
    const blocks = clone.querySelectorAll('p, h1, h2, h3, h4, h5, h6, li, div, br');
    blocks.forEach(node => {
      if (node.tagName === 'BR') return;
      if (node.tagName === 'LI') node.appendChild(document.createTextNode('\n'));
      else node.appendChild(document.createTextNode('\n\n'));
    });
    return clone.textContent.replace(/\n{3,}/g, '\n\n').trim();
  }

  function buildDocHtml(inner) {
    // Minimal Word-compatible HTML wrapper
    const doc =
`<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Document</title>
<style>
  body { font-family: Calibri, Arial, sans-serif; font-size: 12pt; }
  h1 { font-size: 26pt; margin: 0 0 .5em; }
  h2 { font-size: 20pt; margin: 0 0 .5em; }
  h3 { font-size: 16pt; margin: 0 0 .5em; }
  p { margin: 0 0 .6em; }
  ul, ol { margin: 0 0 .6em 1.2em; }
  img { max-width: 100%; height: auto; }
</style>
</head>
<body>
${inner}
</body>
</html>`;
    return doc;
  }

  function downloadBlob(content, filename, type) {
    const blob = new Blob([content], { type });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      URL.revokeObjectURL(a.href);
      a.remove();
    }, 0);
  }

  // Live counters
  const wordEl = document.getElementById('wordCount');
  const charEl = document.getElementById('charCount');
  function updateCounters() {
    const text = editor.textContent || '';
    const words = (text.trim().match(/\S+/g) || []).length;
    const chars = text.replace(/\s/g, '').length;
    wordEl.textContent = 'Words: ' + words;
    charEl.textContent = 'Chars: ' + chars;
  }
  updateCounters();

})();
</script>
</body>
</html>
